<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>90d3c1850d304ac3a9851c001153890c</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="465494c1" class="cell markdown">
<h3 id="introduction">Introduction</h3>
<p>This notebook focuses on analyzing and processing patent data to
extract meaningful insights and prepare it for advanced analysis. Patent
datasets, rich in structured and unstructured information such as
classification codes (CPC, IPC), claims, and descriptions, are crucial
for understanding technological trends, innovation patterns, and
intellectual property landscapes.</p>
<p>The key objectives of this notebook include:</p>
<ol>
<li><strong>Data Exploration and Preparation</strong>: Load, clean, and
sample a large dataset for efficient processing.</li>
<li><strong>Feature Extraction</strong>: Extract relevant features such
as classification codes and claims to enable structured analysis.</li>
<li><strong>Text Processing</strong>: Apply techniques like
tokenization, TF-IDF, and embeddings to process unstructured text
data.</li>
<li><strong>Visualization and Metrics</strong>: Generate insights by
encoding multi-label classifications and evaluating model
performance.</li>
</ol>
<p>By leveraging tools like Python libraries (e.g., pandas, sklearn,
Keras) and techniques like MultiLabelBinarizer and TF-IDF, this notebook
demonstrates how to handle complex datasets, transforming raw patent
data into actionable knowledge for machine learning and other
applications.</p>
</div>
<div id="783746af" class="cell code" data-execution_count="1"
data-scrolled="true">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install tensorflow pandas numpy keras scikit<span class="op">-</span>learn matplotlib nltk keras<span class="op">-</span>metrics beautifulsoup4</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Requirement already satisfied: tensorflow in /opt/anaconda3/lib/python3.12/site-packages (2.16.2)
Requirement already satisfied: pandas in /opt/anaconda3/lib/python3.12/site-packages (2.2.2)
Requirement already satisfied: numpy in /opt/anaconda3/lib/python3.12/site-packages (1.26.4)
Requirement already satisfied: keras in /opt/anaconda3/lib/python3.12/site-packages (3.6.0)
Requirement already satisfied: scikit-learn in /opt/anaconda3/lib/python3.12/site-packages (1.5.1)
Requirement already satisfied: matplotlib in /opt/anaconda3/lib/python3.12/site-packages (3.9.2)
Requirement already satisfied: nltk in /opt/anaconda3/lib/python3.12/site-packages (3.9.1)
Requirement already satisfied: keras-metrics in /opt/anaconda3/lib/python3.12/site-packages (1.1.0)
Requirement already satisfied: beautifulsoup4 in /opt/anaconda3/lib/python3.12/site-packages (4.12.3)
Requirement already satisfied: absl-py&gt;=1.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (2.1.0)
Requirement already satisfied: astunparse&gt;=1.6.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (1.6.3)
Requirement already satisfied: flatbuffers&gt;=23.5.26 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (24.3.25)
Requirement already satisfied: gast!=0.5.0,!=0.5.1,!=0.5.2,&gt;=0.2.1 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (0.6.0)
Requirement already satisfied: google-pasta&gt;=0.1.1 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (0.2.0)
Requirement already satisfied: h5py&gt;=3.10.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (3.11.0)
Requirement already satisfied: libclang&gt;=13.0.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (18.1.1)
Requirement already satisfied: ml-dtypes~=0.3.1 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (0.3.2)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (3.4.0)
Requirement already satisfied: packaging in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (24.1)
Requirement already satisfied: protobuf!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,&lt;5.0.0dev,&gt;=3.20.3 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (4.25.3)
Requirement already satisfied: requests&lt;3,&gt;=2.21.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (2.32.3)
Requirement already satisfied: setuptools in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (75.1.0)
Requirement already satisfied: six&gt;=1.12.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (1.16.0)
Requirement already satisfied: termcolor&gt;=1.1.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (2.5.0)
Requirement already satisfied: typing-extensions&gt;=3.6.6 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (4.11.0)
Requirement already satisfied: wrapt&gt;=1.11.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (1.14.1)
Requirement already satisfied: grpcio&lt;2.0,&gt;=1.24.3 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (1.68.0)
Requirement already satisfied: tensorboard&lt;2.17,&gt;=2.16 in /opt/anaconda3/lib/python3.12/site-packages (from tensorflow) (2.16.2)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /opt/anaconda3/lib/python3.12/site-packages (from pandas) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /opt/anaconda3/lib/python3.12/site-packages (from pandas) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /opt/anaconda3/lib/python3.12/site-packages (from pandas) (2023.3)
Requirement already satisfied: rich in /opt/anaconda3/lib/python3.12/site-packages (from keras) (13.7.1)
Requirement already satisfied: namex in /opt/anaconda3/lib/python3.12/site-packages (from keras) (0.0.8)
Requirement already satisfied: optree in /opt/anaconda3/lib/python3.12/site-packages (from keras) (0.13.1)
Requirement already satisfied: scipy&gt;=1.6.0 in /opt/anaconda3/lib/python3.12/site-packages (from scikit-learn) (1.13.1)
Requirement already satisfied: joblib&gt;=1.2.0 in /opt/anaconda3/lib/python3.12/site-packages (from scikit-learn) (1.4.2)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in /opt/anaconda3/lib/python3.12/site-packages (from scikit-learn) (3.5.0)
Requirement already satisfied: contourpy&gt;=1.0.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib) (1.2.0)
Requirement already satisfied: cycler&gt;=0.10 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib) (0.11.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib) (4.51.0)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib) (1.4.4)
Requirement already satisfied: pillow&gt;=8 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib) (10.4.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /opt/anaconda3/lib/python3.12/site-packages (from matplotlib) (3.1.2)
Requirement already satisfied: click in /opt/anaconda3/lib/python3.12/site-packages (from nltk) (8.1.7)
Requirement already satisfied: regex&gt;=2021.8.3 in /opt/anaconda3/lib/python3.12/site-packages (from nltk) (2024.9.11)
Requirement already satisfied: tqdm in /opt/anaconda3/lib/python3.12/site-packages (from nltk) (4.66.5)
Requirement already satisfied: soupsieve&gt;1.2 in /opt/anaconda3/lib/python3.12/site-packages (from beautifulsoup4) (2.5)
Requirement already satisfied: wheel&lt;1.0,&gt;=0.23.0 in /opt/anaconda3/lib/python3.12/site-packages (from astunparse&gt;=1.6.0-&gt;tensorflow) (0.44.0)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorflow) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorflow) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorflow) (2.2.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/anaconda3/lib/python3.12/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorflow) (2024.8.30)
Requirement already satisfied: markdown&gt;=2.6.8 in /opt/anaconda3/lib/python3.12/site-packages (from tensorboard&lt;2.17,&gt;=2.16-&gt;tensorflow) (3.4.1)
Requirement already satisfied: tensorboard-data-server&lt;0.8.0,&gt;=0.7.0 in /opt/anaconda3/lib/python3.12/site-packages (from tensorboard&lt;2.17,&gt;=2.16-&gt;tensorflow) (0.7.2)
Requirement already satisfied: werkzeug&gt;=1.0.1 in /opt/anaconda3/lib/python3.12/site-packages (from tensorboard&lt;2.17,&gt;=2.16-&gt;tensorflow) (3.0.3)
Requirement already satisfied: markdown-it-py&gt;=2.2.0 in /opt/anaconda3/lib/python3.12/site-packages (from rich-&gt;keras) (2.2.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in /opt/anaconda3/lib/python3.12/site-packages (from rich-&gt;keras) (2.15.1)
Requirement already satisfied: mdurl~=0.1 in /opt/anaconda3/lib/python3.12/site-packages (from markdown-it-py&gt;=2.2.0-&gt;rich-&gt;keras) (0.1.0)
Requirement already satisfied: MarkupSafe&gt;=2.1.1 in /opt/anaconda3/lib/python3.12/site-packages (from werkzeug&gt;=1.0.1-&gt;tensorboard&lt;2.17,&gt;=2.16-&gt;tensorflow) (2.1.3)
</code></pre>
</div>
</div>
<div id="d5e35c12" class="cell code" data-execution_count="2"
data-scrolled="true">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import packages </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gzip</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> LSTM, GRU, Dense, Activation, Dropout, Input, Embedding, Bidirectional, Reshape, Flatten, Conv1D, MaxPooling1D, MaxPool1D, GlobalMaxPool1D, SpatialDropout1D</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> concatenate</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing <span class="im">import</span> text</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> utils</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> callbacks</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> optimizers, models</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> model_selection, preprocessing, metrics</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.utils <span class="im">import</span> to_categorical</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> keras_metrics</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> word_tokenize</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem <span class="im">import</span> PorterStemmer</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">&#39;stopwords&#39;</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">&#39;punkt&#39;</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code></pre></div>
<div class="output stream stderr">
<pre><code>2024-11-18 19:15:19.713198: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
[nltk_data] Downloading package stopwords to
[nltk_data]     /Users/antotim/nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
[nltk_data] Downloading package punkt to /Users/antotim/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
</code></pre>
</div>
</div>
<div id="27e67de8" class="cell markdown">
<h1 id="data-preparation">Data Preparation</h1>
</div>
<div id="7d80ac18-2e32-4ffe-9956-f7fbb75ce901" class="cell markdown">
<p>The code prepares and explores a patent dataset by loading a large
CSV file and sampling 10,000 rows for manageable analysis. It displays
key data fields, including application numbers, dates, classification
codes, claims, and descriptions, providing a foundation for further
processing and analysis.</p>
</div>
<div id="cb01e2a8" class="cell code" data-execution_count="3"
data-scrolled="true">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;EFREI - LIPSTIP - 50k elements EPO.csv&#39;</span>, sep<span class="op">=</span><span class="st">&#39;,&#39;</span>, engine<span class="op">=</span><span class="st">&#39;python&#39;</span>, on_bad_lines<span class="op">=</span><span class="st">&#39;skip&#39;</span>)</span></code></pre></div>
</div>
<div id="836b34e4" class="cell code" data-execution_count="4">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sample(n<span class="op">=</span><span class="dv">10000</span>)</span></code></pre></div>
</div>
<div id="647a420f" class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Numéro d'application</th>
      <th>Date d'application</th>
      <th>Numero de publication</th>
      <th>date de publication</th>
      <th>CPC</th>
      <th>IPC</th>
      <th>claim</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7990</th>
      <td>18170396</td>
      <td>2018-05-02</td>
      <td>3401562</td>
      <td>2018-11-14</td>
      <td>['F16C33-583', 'F16C33-3806', 'F16C19-26', 'F1...</td>
      <td>['F16C33-58', 'F16C33-38', 'F16C33-66', 'F16C1...</td>
      <td>&lt;!-- EPO &lt;DP n="20"&gt; --&gt;&lt;claim id="c-en-0001" ...</td>
      <td>&lt;!-- EPO &lt;DP n="1"&gt; --&gt;&lt;heading id="h0001"&gt;&lt;b&gt;...</td>
    </tr>
    <tr>
      <th>27806</th>
      <td>20169267</td>
      <td>2020-04-14</td>
      <td>3896613</td>
      <td>2021-10-20</td>
      <td>['G06N20-00', 'G06V10-774', 'G06N3-04', 'G06N3...</td>
      <td>['G06N3-00', 'G06V10-774']</td>
      <td>&lt;!-- EPO &lt;DP n="20"&gt; --&gt;&lt;claim id="c-en-0001" ...</td>
      <td>&lt;!-- EPO &lt;DP n="1"&gt; --&gt;&lt;p id="p0001" num="0001...</td>
    </tr>
    <tr>
      <th>22123</th>
      <td>19168754</td>
      <td>2019-04-11</td>
      <td>3557180</td>
      <td>2019-10-23</td>
      <td>['F41J5-06', 'G01L5-14', 'G01L9-0005', 'G01L1-...</td>
      <td>['G01L9-00', 'F41J5-06', 'G01L5-14', 'G01L1-14']</td>
      <td>&lt;!-- EPO &lt;DP n="16"&gt; --&gt;&lt;claim id="c-en-0001" ...</td>
      <td>&lt;!-- EPO &lt;DP n="1"&gt; --&gt;&lt;heading id="h0001"&gt;BAC...</td>
    </tr>
    <tr>
      <th>40117</th>
      <td>17208285</td>
      <td>2017-12-19</td>
      <td>3339810</td>
      <td>2018-06-27</td>
      <td>['A61B5-01', 'G01D1-14', 'G01D1-18', 'A61B5-14...</td>
      <td>['A61B5-00', 'G01D1-14', 'G01D1-18', 'H04L29-08']</td>
      <td>&lt;!-- EPO &lt;DP n="37"&gt; --&gt;&lt;claim id="c-en-0001" ...</td>
      <td>&lt;!-- EPO &lt;DP n="1"&gt; --&gt;&lt;heading id="h0001"&gt;&lt;u&gt;...</td>
    </tr>
    <tr>
      <th>18432</th>
      <td>18831506</td>
      <td>2018-04-16</td>
      <td>3653989</td>
      <td>2020-05-20</td>
      <td>['G01B11-24', 'A61C9-0053', 'A61C9-006', 'A61C...</td>
      <td>['G01B11-00', 'G01B11-24', 'G01S17-89', 'G01C3...</td>
      <td>&lt;!-- EPO &lt;DP n="60"&gt; --&gt;&lt;claim id="c-en-0001" ...</td>
      <td>&lt;!-- EPO &lt;DP n="1"&gt; --&gt;&lt;heading id="h0001"&gt;TEC...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="02697f49" class="cell code" data-execution_count="6">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div>
<div class="output execute_result" data-execution_count="6">
<pre><code>Index([&#39;Numéro d&#39;application&#39;, &#39;Date d&#39;application&#39;, &#39;Numero de publication&#39;,
       &#39;date de publication&#39;, &#39;CPC&#39;, &#39;IPC&#39;, &#39;claim&#39;, &#39;description&#39;],
      dtype=&#39;object&#39;)</code></pre>
</div>
</div>
<div id="a58efd29" class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize stopwords and stemmer</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>stop_words <span class="op">=</span> <span class="bu">set</span>(stopwords.words(<span class="st">&#39;english&#39;</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>stemmer <span class="op">=</span> PorterStemmer()  <span class="co"># Initialize PorterStemmer for stemming</span></span></code></pre></div>
</div>
<div id="10a2fdc4" class="cell code" data-execution_count="8">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for text preprocessing</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_text(text):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract text from XML tags</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(text, <span class="st">&quot;lxml&quot;</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    clean_text <span class="op">=</span> soup.get_text(separator<span class="op">=</span><span class="st">&#39; &#39;</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert text to lowercase</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    clean_text <span class="op">=</span> clean_text.lower()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove punctuation and special characters</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    clean_text <span class="op">=</span> re.sub(<span class="vs">r&#39;[^a-z0-9\s]&#39;</span>, <span class="st">&#39;&#39;</span>, clean_text)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Specifically remove the word &quot;claim&quot;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    clean_text <span class="op">=</span> clean_text.replace(<span class="st">&#39;claim&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove stop words</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    clean_text <span class="op">=</span> <span class="st">&#39; &#39;</span>.join([word <span class="cf">for</span> word <span class="kw">in</span> clean_text.split() <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> stop_words])</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> clean_text</span></code></pre></div>
</div>
<div id="ce3763ca" class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply preprocessing</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(preprocess_text)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(preprocess_text)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>elapsed_time <span class="op">=</span> time.time() <span class="op">-</span> start_time</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Execution Time: </span><span class="sc">{</span>elapsed_time<span class="sc">:.2f}</span><span class="ss"> seconds&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Execution Time: 148.80 seconds
</code></pre>
</div>
</div>
<div id="ba870f66" class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the required columns as DataFrames</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>claim <span class="op">=</span> df[[<span class="st">&#39;Numero de publication&#39;</span>, <span class="st">&#39;claim&#39;</span>]]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>desc <span class="op">=</span> df[[<span class="st">&#39;Numero de publication&#39;</span>, <span class="st">&#39;description&#39;</span>]]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>cpc <span class="op">=</span> df[[<span class="st">&#39;Numero de publication&#39;</span>, <span class="st">&#39;CPC&#39;</span>]]</span></code></pre></div>
</div>
<div id="9730275e" class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate the DataFrames on the &#39;doc_num&#39; index</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.concat([claim.set_index(<span class="st">&#39;Numero de publication&#39;</span>), </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>               desc.set_index(<span class="st">&#39;Numero de publication&#39;</span>)], axis<span class="op">=</span><span class="dv">1</span>).sort_index()</span></code></pre></div>
</div>
<div id="c7dba526" class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="12">
<pre><code>(10000, 2)</code></pre>
</div>
</div>
<div id="ee13e474" class="cell code" data-execution_count="13">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>X.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="13">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>claim</th>
      <th>description</th>
    </tr>
    <tr>
      <th>Numero de publication</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3189756</th>
      <td>apparatus comprising housing first second side...</td>
      <td>technical field specification relates generall...</td>
    </tr>
    <tr>
      <th>3189866</th>
      <td>pump comprising compression compartment config...</td>
      <td>field invention present invention relates gene...</td>
    </tr>
    <tr>
      <th>3189922</th>
      <td>device 300 aperture 307 receiving tube 340 com...</td>
      <td>field disclosure relates generally gas turbine...</td>
    </tr>
    <tr>
      <th>3190141</th>
      <td>polymer repeating unit structure represented f...</td>
      <td>technical field disclosure relates polymer par...</td>
    </tr>
    <tr>
      <th>3192446</th>
      <td>bronchial piercing catheter assembly used navi...</td>
      <td>background technical field present disclosure ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="db74d48b" class="cell code" data-execution_count="14">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract unique elements from a string</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_unique_elements(string_list):</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert the string representing a list into a Python list</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        elements_list <span class="op">=</span> ast.literal_eval(string_list)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use a set to remove duplicates and return a sorted list</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        unique_elements <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(elements_list))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the first character of each element</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        first_chars <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(element[<span class="dv">0</span>] <span class="cf">for</span> element <span class="kw">in</span> unique_elements))</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return the list of first characters</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">list</span>(first_chars)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In case of an error, return an empty string or handle the error as needed</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;&#39;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div id="41b3eb11" class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the extraction function to the column and create a new column in the DataFrame</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;nbre_cpc&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;CPC&#39;</span>].<span class="bu">apply</span>(extract_unique_elements)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the new column</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">&#39;nbre_cpc&#39;</span>].head())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>7990           [F]
27806          [G]
22123       [F, G]
40117    [A, G, H]
18432       [A, G]
Name: nbre_cpc, dtype: object
</code></pre>
</div>
</div>
<div id="8684ddba" class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to count the number of elements in a string representing a list</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_elements(string_list):</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert the string representing a list into a Python list</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        elements_list <span class="op">=</span> ast.literal_eval(string_list)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return the number of elements in the list</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(elements_list)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In case of an error, return 0 or handle the error as needed</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span></code></pre></div>
</div>
<div id="9545288c" class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the counting function to the column and find the maximum</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>max_elements <span class="op">=</span> df[<span class="st">&#39;CPC&#39;</span>].<span class="bu">apply</span>(count_elements).<span class="bu">max</span>()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the maximum number of elements</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Maximum number of elements in the CPC column:&quot;</span>, max_elements)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Maximum number of elements in the CPC column: 66
</code></pre>
</div>
</div>
<div id="e06d5da0" class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty DataFrame with the correct columns</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>df[<span class="st">&#39;Numero de publication&#39;</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for each unique element in nbre_cpc</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>max_elements <span class="op">=</span> df[<span class="st">&#39;nbre_cpc&#39;</span>].<span class="bu">apply</span>(<span class="bu">len</span>).<span class="bu">max</span>()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, max_elements <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    Y[<span class="ss">f&#39;CPC_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">&#39;</span>] <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add elements into the corresponding columns</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, cpc_code <span class="kw">in</span> <span class="bu">enumerate</span>(row[<span class="st">&#39;nbre_cpc&#39;</span>], start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        Y.at[row[<span class="st">&#39;Numero de publication&#39;</span>], <span class="ss">f&#39;CPC_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">&#39;</span>] <span class="op">=</span> cpc_code</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the resulting DataFrame Y</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y.head())</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>                      CPC_1 CPC_2 CPC_3 CPC_4 CPC_5
Numero de publication                              
3401562                   F                        
3896613                   G                        
3557180                   F     G                  
3339810                   A     G     H            
3653989                   A     G                  
</code></pre>
</div>
</div>
<div id="5cc955d2" class="cell code" data-execution_count="19">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Y.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="19">
<pre><code>(10000, 5)</code></pre>
</div>
</div>
<div id="5df9b55c" class="cell code" data-execution_count="20">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data cleaning </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> Y[<span class="st">&#39;CPC_1&#39;</span>].isnull().<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span> <span class="co"># there is no document with </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st"> documents with null claim&quot;</span>.<span class="bu">format</span>(X[<span class="st">&#39;claim&#39;</span>].isnull().<span class="bu">sum</span>()))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{}</span><span class="st"> documents with null description&quot;</span>.<span class="bu">format</span>(X[<span class="st">&#39;description&#39;</span>].isnull().<span class="bu">sum</span>()))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing documents with null sections (title and abstract)</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>X_clean <span class="op">=</span> X.dropna(how<span class="op">=</span><span class="st">&#39;any&#39;</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>null_idx <span class="op">=</span> X[<span class="op">~</span>X.index.isin(X_clean.index)].index <span class="co"># storing the removed indices (i.e. document numbers)</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> X.shape[<span class="dv">0</span>] <span class="op">-</span> null_idx.shape[<span class="dv">0</span>] <span class="op">==</span> X_clean.shape[<span class="dv">0</span>] <span class="co"># making sure the row counts match</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing the documents with null sections from the CPC as well </span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>Y_clean <span class="op">=</span> Y.loc[X_clean.index]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Some checks</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> X_clean.shape[<span class="dv">0</span>] <span class="op">==</span> Y_clean.shape[<span class="dv">0</span>]</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> ((Y_clean.index <span class="op">==</span> X_clean.index)<span class="op">*</span><span class="dv">1</span>).<span class="bu">sum</span>() <span class="op">==</span> X_clean.shape[<span class="dv">0</span>]</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower-casing everything</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>X_clean <span class="op">=</span> X_clean.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">str</span>.lower())</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>Y_clean <span class="op">=</span> Y_clean.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">str</span>.lower())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0 documents with null claim
0 documents with null description
</code></pre>
</div>
</div>
<div id="ad38010b" class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_clean.shape)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y_clean.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(10000, 2)
(10000, 5)
</code></pre>
</div>
</div>
<div id="4ad1e83d" class="cell code" data-execution_count="22">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>X_clean.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="22">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>claim</th>
      <th>description</th>
    </tr>
    <tr>
      <th>Numero de publication</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3189756</th>
      <td>apparatus comprising housing first second side...</td>
      <td>technical field specification relates generall...</td>
    </tr>
    <tr>
      <th>3189866</th>
      <td>pump comprising compression compartment config...</td>
      <td>field invention present invention relates gene...</td>
    </tr>
    <tr>
      <th>3189922</th>
      <td>device 300 aperture 307 receiving tube 340 com...</td>
      <td>field disclosure relates generally gas turbine...</td>
    </tr>
    <tr>
      <th>3190141</th>
      <td>polymer repeating unit structure represented f...</td>
      <td>technical field disclosure relates polymer par...</td>
    </tr>
    <tr>
      <th>3192446</th>
      <td>bronchial piercing catheter assembly used navi...</td>
      <td>background technical field present disclosure ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="37535b6f" class="cell code" data-execution_count="23">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>Y_clean.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="23">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CPC_1</th>
      <th>CPC_2</th>
      <th>CPC_3</th>
      <th>CPC_4</th>
      <th>CPC_5</th>
    </tr>
    <tr>
      <th>Numero de publication</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3189756</th>
      <td>a</td>
      <td>f</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3189866</th>
      <td>a</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3189922</th>
      <td>b</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3190141</th>
      <td>c</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3192446</th>
      <td>a</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="68b340a8" class="cell code" data-execution_count="24">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating dataset </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> X_clean</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Concat the text of all patent sections and join the labels</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># data[&#39;full_text&#39;] = + X_clean[&#39;claim&#39;] + &quot; &quot; + X_clean[&#39;desc&#39;]</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Using only the first CPC  </span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;CPC_1&#39;</span>] <span class="op">=</span> Y_clean[<span class="st">&#39;CPC_1&#39;</span>] </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Using all labels, merging them in a list and removing None values</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;CPC&#39;</span>] <span class="op">=</span> Y_clean.values.tolist()</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;CPC&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;CPC&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">list</span>(<span class="bu">filter</span>(<span class="va">None</span>, x)))</span></code></pre></div>
</div>
<div id="8df1eb5f" class="cell code" data-execution_count="25"
data-scrolled="true">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="25">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>claim</th>
      <th>description</th>
      <th>CPC_1</th>
      <th>CPC</th>
    </tr>
    <tr>
      <th>Numero de publication</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3189756</th>
      <td>apparatus comprising housing first second side...</td>
      <td>technical field specification relates generall...</td>
      <td>a</td>
      <td>[a, f]</td>
    </tr>
    <tr>
      <th>3189866</th>
      <td>pump comprising compression compartment config...</td>
      <td>field invention present invention relates gene...</td>
      <td>a</td>
      <td>[a]</td>
    </tr>
    <tr>
      <th>3189922</th>
      <td>device 300 aperture 307 receiving tube 340 com...</td>
      <td>field disclosure relates generally gas turbine...</td>
      <td>b</td>
      <td>[b]</td>
    </tr>
    <tr>
      <th>3190141</th>
      <td>polymer repeating unit structure represented f...</td>
      <td>technical field disclosure relates polymer par...</td>
      <td>c</td>
      <td>[c]</td>
    </tr>
    <tr>
      <th>3192446</th>
      <td>bronchial piercing catheter assembly used navi...</td>
      <td>background technical field present disclosure ...</td>
      <td>a</td>
      <td>[a]</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="30bcad4f" class="cell markdown">
<h1 id="encoding-labels-with-multilabelbinarizer">Encoding Labels with
MultiLabelBinarizer</h1>
</div>
<div id="e188b5fa-bb45-4f32-8f77-8876ae1dfeae" class="cell markdown">
<p>The MultiLabelBinarizer is used to transform a list of labels
associated with each data instance into a binary matrix format. Each
unique label is represented as a column, and the rows correspond to data
instances. If a data instance contains a specific label, the
corresponding column is marked with 1; otherwise, it is 0.</p>
<p>This encoding is especially useful for:</p>
<p>Multi-label classification tasks. Representing label data in a format
suitable for machine learning algorithms.</p>
</div>
<div id="73128f1c" class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;CPC&#39;</span>].head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="26">
<pre><code>Numero de publication
3189756    [a, f]
3189866       [a]
3189922       [b]
3190141       [c]
3192446       [a]
Name: CPC, dtype: object</code></pre>
</div>
</div>
<div id="eaab1d3d" class="cell code" data-execution_count="27">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting labels into a binarized matrix with the labels as columns  and each patent document represented in one row</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>mlb <span class="op">=</span> preprocessing.MultiLabelBinarizer()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>cpc <span class="op">=</span> mlb.fit_transform(data[<span class="st">&#39;CPC&#39;</span>])</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking that the conversion worked as desired by verifying the counts of labels for each document prior and post </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> data[<span class="st">&#39;CPC&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">len</span>(x)).values.<span class="bu">sum</span>() <span class="op">==</span> np.array(pd.DataFrame(cpc).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">sum</span>(),axis<span class="op">=</span><span class="dv">1</span>)).<span class="bu">sum</span>()</span></code></pre></div>
</div>
<div id="b4a395be" class="cell code" data-execution_count="28"
data-scrolled="true">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cpc_df <span class="op">=</span> pd.DataFrame(cpc, columns<span class="op">=</span>mlb.classes_)  <span class="co">#.apply(lambda x: x.sum(),axis=1)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>cpc_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="28">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
      <th>e</th>
      <th>f</th>
      <th>g</th>
      <th>h</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="2942f440" class="cell code" data-execution_count="29">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;We have </span><span class="sc">{}</span><span class="st"> classes&quot;</span>.<span class="bu">format</span>(<span class="bu">len</span>(mlb.classes_)))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>We have 9 classes
</code></pre>
</div>
</div>
<div id="574c3a0d" class="cell code" data-execution_count="30">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking how many times does each label (i.e. class) appear in the data </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we observe that the classes are a little unbalanced </span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>pl <span class="op">=</span> cpc_df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.<span class="bu">sum</span>(),axis<span class="op">=</span><span class="dv">0</span>).sort_values(ascending<span class="op">=</span><span class="va">False</span>)  <span class="co">#.plot.bar()</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>pl.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="30">
<pre><code>h    3214
g    3021
b    2452
a    1582
y    1374
dtype: int64</code></pre>
</div>
</div>
<div id="6dc42f8c" class="cell markdown">
<h1 id="advanced-text-processing-and-tf_idf">Advanced text processing
and TF_IDF</h1>
</div>
<div id="c4c88f61" class="cell raw">

</div>
<div id="19bbec6e" class="cell markdown">
<h2 id="1-advanced-processing">1. Advanced Processing</h2>
</div>
<div id="fb6d73c2" class="cell code" data-execution_count="31">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing punctuation</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re, string, timeit</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>regex <span class="op">=</span> re.<span class="bu">compile</span>(<span class="st">&#39;[</span><span class="sc">%s</span><span class="st">]&#39;</span> <span class="op">%</span> re.escape(string.punctuation), re.MULTILINE)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : regex.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : regex.sub(<span class="st">&quot;&quot;</span>, x))</span></code></pre></div>
</div>
<div id="19dffeb8" class="cell code" data-execution_count="32">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing whitespace</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&quot;^\s+&quot;</span>, re.MULTILINE)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r.sub(<span class="st">&quot;&quot;</span>, x))</span></code></pre></div>
</div>
<div id="036fa20d" class="cell code" data-execution_count="33">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting to lower - casing </span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : x.lower())</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : x.lower())</span></code></pre></div>
</div>
<div id="44800edc" class="cell code" data-execution_count="34">
<div class="sourceCode" id="cb48"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing URLs</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>re_url <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&#39;^http\S+&#39;</span>, re.MULTILINE<span class="op">|</span>re.UNICODE)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : re_url.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : re_url.sub(<span class="st">&quot;&quot;</span>, x))</span></code></pre></div>
</div>
<div id="48c4e874" class="cell code" data-execution_count="35">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing text that has claim and a number</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&#39;(?:claim\S\d+|claim\S \d+|claim \d+|claims?)&#39;</span>, re.MULTILINE<span class="op">|</span>re.UNICODE)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r1.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r1.sub(<span class="st">&quot;&quot;</span>, x))</span></code></pre></div>
</div>
<div id="e8011e30" class="cell code" data-execution_count="36">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Introducing space on either side of new line</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&#39;.\n&#39;</span>, re.MULTILINE<span class="op">|</span>re.UNICODE)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot; </span><span class="ch">\n</span><span class="st"> &quot;</span>, x))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot; </span><span class="ch">\n</span><span class="st"> &quot;</span>, x))</span></code></pre></div>
</div>
<div id="07287567" class="cell code" data-execution_count="37">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing temperature data such as 105°</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&quot;\d+°?&quot;</span>, re.MULTILINE)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span></code></pre></div>
</div>
<div id="e1de73e1" class="cell code" data-execution_count="38">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing special characters \xad</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&quot;\xad&quot;</span>, re.MULTILINE)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span></code></pre></div>
</div>
<div id="9e404222" class="cell code" data-execution_count="39">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing special characters - &#39;&#39;, and ¬,</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">str</span>.replace(<span class="st">&#39;</span><span class="ch">\&#39;</span><span class="st">&#39;</span>,<span class="st">&#39;&#39;</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">str</span>.replace(<span class="st">&#39;</span><span class="ch">\&#39;</span><span class="st">&#39;</span>,<span class="st">&#39;&#39;</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">str</span>.replace(<span class="st">&#39;¬&#39;</span>,<span class="st">&#39;&#39;</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">str</span>.replace(<span class="st">&#39;¬&#39;</span>,<span class="st">&#39;&#39;</span>)</span></code></pre></div>
</div>
<div id="0f542367" class="cell code" data-execution_count="40">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing special characters &quot;&#39; and ¬&quot;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&quot;[&#39;]&quot;</span>, re.MULTILINE)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&quot;[¬]&quot;</span>, re.MULTILINE)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span></code></pre></div>
</div>
<div id="4637a3c5" class="cell code" data-execution_count="41">
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing dots from the data</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r&quot;[.]&quot;</span>, re.MULTILINE)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;claim&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;claim&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;description&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;description&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x : r2.sub(<span class="st">&quot;&quot;</span>, x))</span></code></pre></div>
</div>
<div id="b474d712" class="cell code" data-execution_count="42">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging all the two sections</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;full_text1&#39;</span>] <span class="op">=</span> X_clean[<span class="st">&#39;claim&#39;</span>] <span class="op">+</span><span class="st">&quot; </span><span class="ch">\n</span><span class="st"> &quot;</span> <span class="op">+</span> X_clean[<span class="st">&#39;description&#39;</span>]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;full_text1&#39;</span>].head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="42">
<pre><code>Numero de publication
3189756    apparatus comprising housing first second side...
3189866    pump comprising compression compartment config...
3189922    device  aperture  receiving tube  comprising i...
3190141    polymer repeating unit structure represented f...
3192446    bronchial piercing catheter assembly used navi...
Name: full_text1, dtype: object</code></pre>
</div>
</div>
<div id="a2c2713e" class="cell markdown">
<h1 id="use-keras-tokenizer-to-create-sequences--tokens-of-the-text">Use
Keras tokenizer to create sequences / tokens of the text</h1>
</div>
<div id="7d79d8e5-091a-454e-8c42-8a536c4e077b" class="cell markdown">
<p>The Keras Tokenizer is used to convert text data into sequences of
integers (tokens), which are easier for machine learning models to
process. It works by:</p>
<ul>
<li><p>Tokenizing: Splitting the text into words (tokens) and assigning
each unique word a numeric index.</p></li>
<li><p>Encoding: Converting the text into sequences of integers based on
the assigned indices.</p></li>
<li><p>Padding/Truncating: Adjusting the length of sequences to ensure
uniformity.</p></li>
</ul>
</div>
<div id="81ee2a34" class="cell code" data-execution_count="43">
<div class="sourceCode" id="cb58"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>token <span class="op">=</span> text.Tokenizer(filters<span class="op">=</span><span class="st">&#39;.°™</span><span class="ch">\&#39;</span><span class="st">¯⊘■®&#39;</span>) <span class="co"># num_words=sequence_length lower=True</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>token.fit_on_texts(data[<span class="st">&#39;full_text1&#39;</span>])</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>word_index <span class="op">=</span> token.word_index</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Number of words in our vocabulary: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(<span class="bu">len</span>(word_index.keys())))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Number of words in our vocabulary: 208026
</code></pre>
</div>
</div>
<div id="9149ee78" class="cell code" data-execution_count="44">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting the full text to sequences and then back to text.</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This helps in getting the cleaned text after applying filters that used in the keras tokenizer</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>data_full_text_seq <span class="op">=</span> token.texts_to_sequences(data[<span class="st">&#39;full_text1&#39;</span>])</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>data_full_text_txt <span class="op">=</span> token.sequences_to_texts(data_full_text_seq)</span></code></pre></div>
</div>
<div id="693b6192" class="cell markdown">
<h1 id="create-word-embeddings-using-cbow-word2vec">Create Word
embeddings using CBOW (Word2vec)</h1>
</div>
<div id="a8d052c3" class="cell markdown">
<p>The Continuous Bag of Words (CBOW) model, part of Word2Vec, creates
word embeddings by predicting a target word based on its surrounding
context words. The process involves:</p>
<ul>
<li><p>Input: A window of context words (e.g., words surrounding the
target word).</p></li>
<li><p>Output: A dense vector representation (embedding) for each word,
capturing semantic meanings and relationships.</p></li>
<li><p>Training: The model adjusts embeddings so that similar words
(e.g., synonyms or related concepts) have closer vector
representations.</p></li>
</ul>
</div>
<div id="db29462c" class="cell markdown">
<h2 id="create-input-text-for-the-word-embedding-algorithm">Create input
text for the word embedding algorithm</h2>
</div>
<div id="1ee57789" class="cell code" data-execution_count="45">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> WordPunctTokenizer</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> string <span class="im">import</span> punctuation, ascii_lowercase</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>vocab <span class="op">=</span> Counter()</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>tokenizer_word <span class="op">=</span> WordPunctTokenizer()</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> text_to_wordlist(text):</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Tokenize</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> tokenizer_word.tokenize(text)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Return a list of words</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    vocab.update(text)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_comments(list_sentences, lower<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    comments <span class="op">=</span> []</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> text <span class="kw">in</span> tqdm(list_sentences):</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>        txt <span class="op">=</span> text_to_wordlist(text)</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        comments.append(txt)</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> comments</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>CBOW_input_full_text <span class="op">=</span> process_comments(data_full_text_txt)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>100%|████████████████████████████████████| 10000/10000 [00:39&lt;00:00, 252.37it/s]
</code></pre>
</div>
</div>
<div id="8bcc4175" class="cell markdown">
<h1 id="gensim-word2vec---cbow-model">Gensim Word2Vec - CBOW Model</h1>
</div>
<div id="000af5f6" class="cell code" data-execution_count="46"
data-scrolled="true">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gensim.models <span class="im">import</span> Word2Vec</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Word2Vec(sentences<span class="op">=</span>CBOW_input_full_text,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>                 window<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>                 vector_size<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>                 min_count<span class="op">=</span><span class="dv">1</span>,  <span class="co"># Adjust min_count based on your data</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                 workers<span class="op">=</span><span class="dv">16</span>,   <span class="co"># Adjust workers based on your system</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>                 sg<span class="op">=</span><span class="dv">0</span>)         <span class="co"># sg=0 for CBOW, sg=1 for skip-gram</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessing word vectors</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>word_vectors <span class="op">=</span> model.wv</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Example to get the number of word vectors</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>num_word_vectors <span class="op">=</span> <span class="bu">len</span>(model.wv.key_to_index)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Number of word vectors: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(num_word_vectors))</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">1</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Number of word vectors: 208025
CPU times: user 11min, sys: 14.1 s, total: 11min 14s
Wall time: 3min 24s
</code></pre>
</div>
</div>
<div id="40e4e4fc" class="cell markdown">
<h2 id="create-embedding-matrix">Create embedding matrix</h2>
</div>
<div id="e00374a4" class="cell code" data-execution_count="47">
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create embedding matrix</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>embedding_dim <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>embedding_matrix <span class="op">=</span> np.zeros((<span class="bu">len</span>(word_index) <span class="op">+</span> <span class="dv">1</span>, embedding_dim))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> word, i <span class="kw">in</span> word_index.items():</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> word <span class="kw">in</span> vocab:    </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>        embedding_vector <span class="op">=</span> word_vectors[word]</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>        embedding_vector <span class="op">=</span> <span class="va">None</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> embedding_vector <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># words not found in embedding index will be all-zeros.</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>        embedding_matrix[i] <span class="op">=</span> embedding_vector</span></code></pre></div>
</div>
<div id="d1aef15a" class="cell code" data-execution_count="48">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>embedding_matrix.shape</span></code></pre></div>
<div class="output execute_result" data-execution_count="48">
<pre><code>(208027, 100)</code></pre>
</div>
</div>
<div id="966c8928" class="cell markdown">
<h1 id="tf-idf-methodology-to-extract-important-words">TF IDF
Methodology to extract important words</h1>
</div>
<div id="36cbca7d" class="cell markdown">
<p>The TF-IDF (Term Frequency-Inverse Document Frequency) methodology
identifies important words in a document by measuring their relevance in
relation to a collection of documents. It works in two steps:</p>
<ul>
<li><p>Term Frequency (TF): Measures how often a word appears in a
document.</p></li>
<li><p>Inverse Document Frequency (IDF): Reduces the weight of common
words by measuring how often a word appears across all
documents.</p></li>
</ul>
<p>TF-IDF Score: Combines TF and IDF to highlight words that are
frequent in a document but rare in the corpus.</p>
</div>
<div id="d93ab797" class="cell code" data-execution_count="49">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a TFIDF Vecxtorizer and pass the preprocessed full text</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>tfidf <span class="op">=</span> TfidfVectorizer(lowercase<span class="op">=</span><span class="va">True</span>, analyzer<span class="op">=</span><span class="st">&#39;word&#39;</span>, smooth_idf<span class="op">=</span><span class="va">False</span>, sublinear_tf<span class="op">=</span><span class="va">False</span>, norm<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>                        stop_words<span class="op">=</span><span class="st">&#39;english&#39;</span>, ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>)) </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>text_transformed <span class="op">=</span> tfidf.fit_transform(data[<span class="st">&#39;full_text1&#39;</span>])</span></code></pre></div>
</div>
<div id="a8325aaf" class="cell code" data-execution_count="50">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the data for claim and description using TFIDF model </span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># store the TFIDF values for the words for each of the sections</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>claim_tfidf <span class="op">=</span>  tfidf.transform(data[<span class="st">&#39;claim&#39;</span>])</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>desc_tfidf <span class="op">=</span>  tfidf.transform(data[<span class="st">&#39;description&#39;</span>])</span></code></pre></div>
</div>
<div id="54dfa834" class="cell code" data-execution_count="51">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize dataframes to store top words based on TF IDF for each of the sections.</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>col_names <span class="op">=</span>  [<span class="st">&#39;i&#39;</span>,<span class="st">&#39;top_words&#39;</span>]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>max_length <span class="op">=</span> <span class="dv">150</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>claim_top_words  <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> col_names)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>desc_top_words  <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> col_names)</span></code></pre></div>
</div>
<div id="4f96541f" class="cell markdown">
<h2 id="get-top-words-for-claim-using-tfidf">Get top words for Claim
using TFIDF</h2>
</div>
<div id="65924ada" class="cell code" data-execution_count="52">
<div class="sourceCode" id="cb71"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> np.array(tfidf.get_feature_names_out())</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(text_transformed.shape[<span class="dv">0</span>])):</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    f_index <span class="op">=</span> claim_tfidf[i,:].nonzero()[<span class="dv">1</span>]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    tfid_score <span class="op">=</span> <span class="bu">zip</span>(f_index,[claim_tfidf[i,x] <span class="cf">for</span> x <span class="kw">in</span> f_index])</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    word <span class="op">=</span> []</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> []</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> w,s <span class="kw">in</span> [(feature_names[i],s) <span class="cf">for</span> i,s <span class="kw">in</span> tfid_score]:</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>        word.append(w)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>        score.append(s)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> np.array(score)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    word <span class="op">=</span> np.array(word)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    txt <span class="op">=</span> <span class="st">&quot; &quot;</span>.join(word[(<span class="op">-</span>score).argsort()[:max_length]])</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    claim_top_words.loc[<span class="bu">len</span>(claim_top_words)] <span class="op">=</span> [i,txt]</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<div class="output stream stderr">
<pre><code>100%|████████████████████████████████████| 10000/10000 [00:40&lt;00:00, 245.40it/s]
</code></pre>
</div>
</div>
<div id="30e96d55" class="cell markdown">
<h2 id="get-top-words-for-description-using-tfidf">Get top words for
description using TFIDF</h2>
</div>
<div id="503386d0" class="cell code" data-execution_count="53">
<div class="sourceCode" id="cb73"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(text_transformed.shape[<span class="dv">0</span>])):</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    f_index <span class="op">=</span> desc_tfidf[i,:].nonzero()[<span class="dv">1</span>]</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    tfid_score <span class="op">=</span> <span class="bu">zip</span>(f_index,[desc_tfidf[i,x] <span class="cf">for</span> x <span class="kw">in</span> f_index])</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    word <span class="op">=</span> []</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> []</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> w,s <span class="kw">in</span> [(feature_names[i],s) <span class="cf">for</span> i,s <span class="kw">in</span> tfid_score]:</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        word.append(w)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>        score.append(s)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> np.array(score)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    word <span class="op">=</span> np.array(word)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>    txt <span class="op">=</span> <span class="st">&quot; &quot;</span>.join(word[(<span class="op">-</span>score).argsort()[:max_length]])</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    desc_top_words.loc[<span class="bu">len</span>(desc_top_words)] <span class="op">=</span> [i,txt]</span></code></pre></div>
<div class="output stream stderr">
<pre><code>100%|█████████████████████████████████████| 10000/10000 [03:01&lt;00:00, 55.18it/s]
</code></pre>
</div>
</div>
<div id="6e995526" class="cell code" data-execution_count="54">
<div class="sourceCode" id="cb75"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>claim_top_words.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="54">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>i</th>
      <th>top_words</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>arm drawer wheels wheel position second rollab...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>responsively electrode fraction second fluid p...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>braze necked diameter filler aperture portion ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>ar alkyl polymer independently ed unsubstitute...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>catheter bronchial piercing tip member assembl...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="66566170" class="cell code" data-execution_count="55">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>desc_top_words.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="55">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>i</th>
      <th>top_words</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>drawer rollable arm wheels housing position mi...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>irrigation compartment fluid paddle sack elect...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>braze filler tube necked turbine aperture tap ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>ar polymer substituted polyarylene diradical a...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>catheter ewc piercing bronchial biopsy tip bro...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="d10a6b68" class="cell markdown">
<h1
id="create-new-datatable-to-store-the-top-150-words-from-each-of-the-2-sections">Create
new datatable to store the top 150 words from each of the 2
sections</h1>
</div>
<div id="3ff56f18" class="cell code" data-execution_count="56">
<div class="sourceCode" id="cb77"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>desc_top_words.columns <span class="op">=</span> [<span class="st">&#39;desc_no&#39;</span>,<span class="st">&#39;description&#39;</span>]</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>claim_top_words.columns <span class="op">=</span> [<span class="st">&#39;claim_no&#39;</span>,<span class="st">&#39;claim&#39;</span>]</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>Data_Final <span class="op">=</span> pd.concat([claim_top_words[<span class="st">&#39;claim&#39;</span>], </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>           desc_top_words[<span class="st">&#39;description&#39;</span>]], axis<span class="op">=</span><span class="dv">1</span>).sort_index() </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>Data_Final.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="56">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>claim</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>arm drawer wheels wheel position second rollab...</td>
      <td>drawer rollable arm wheels housing position mi...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>responsively electrode fraction second fluid p...</td>
      <td>irrigation compartment fluid paddle sack elect...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>braze necked diameter filler aperture portion ...</td>
      <td>braze filler tube necked turbine aperture tap ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ar alkyl polymer independently ed unsubstitute...</td>
      <td>ar polymer substituted polyarylene diradical a...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>catheter bronchial piercing tip member assembl...</td>
      <td>catheter ewc piercing bronchial biopsy tip bro...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="10fb567f" class="cell markdown">
<h1 id="test-train-split">Test Train split</h1>
</div>
<div id="42f8a367" class="cell code" data-execution_count="57">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train test split </span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>X_train, X_test, Y_train, Y_test <span class="op">=</span> model_selection.train_test_split(Data_Final, cpc, test_size<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_test.shape)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y_train.shape)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Y_test.shape)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>     </span></code></pre></div>
<div class="output stream stdout">
<pre><code>(8000, 2)
(2000, 2)
(8000, 9)
(2000, 9)
</code></pre>
</div>
</div>
<div id="9fa91275" class="cell markdown">
<h1
id="padding-train-and-test-data-and-converting-them-to-sequences">Padding
train and test data and converting them to sequences</h1>
</div>
<div id="b6e0c36e" class="cell code" data-execution_count="58"
data-scrolled="true">
<div class="sourceCode" id="cb80"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforming text documents to sequence of tokens and padding them to ensure equal length vectors</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Choosing the median document length as max length for padding</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing <span class="im">import</span> sequence</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>sequence_length <span class="op">=</span> <span class="dv">150</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Input matrix for the two sections for train and test</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>X_train_claim_seq <span class="op">=</span> sequence.pad_sequences(token.texts_to_sequences(X_train[<span class="st">&#39;claim&#39;</span>]), maxlen<span class="op">=</span>sequence_length)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>X_train_desc_seq <span class="op">=</span> sequence.pad_sequences(token.texts_to_sequences(X_train[<span class="st">&#39;description&#39;</span>]), maxlen<span class="op">=</span>sequence_length)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>X_test_claim_seq <span class="op">=</span> sequence.pad_sequences(token.texts_to_sequences(X_test[<span class="st">&#39;claim&#39;</span>]), maxlen<span class="op">=</span>sequence_length)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>X_test_desc_seq <span class="op">=</span> sequence.pad_sequences(token.texts_to_sequences(X_test[<span class="st">&#39;description&#39;</span>]), maxlen<span class="op">=</span>sequence_length)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train_claim_seq.shape)</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_test_claim_seq.shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(8000, 150)
(2000, 150)
</code></pre>
</div>
</div>
<div id="9dd6825d" class="cell markdown">
<h1 id="hyper-parameters-for-cnn---bilstm-model">Hyper parameters for
CNN - BILSTM Model</h1>
</div>
<div id="80273eb4" class="cell code" data-execution_count="59">
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>vocabulary_size <span class="op">=</span> embedding_matrix.shape[<span class="dv">0</span>]</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>sequence_length <span class="op">=</span> sequence_length</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>embedding_dim <span class="op">=</span> embedding_matrix.shape[<span class="dv">1</span>]</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>num_filters <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>kernel_size <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>pool_size <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>units <span class="op">=</span> Y_train.shape[<span class="dv">1</span>]  <span class="co"># we need the output nodes to equal the number of classes (96)</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>lstm_units <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Training Parameters </span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">20</span></span></code></pre></div>
</div>
<div id="184944b3" class="cell markdown">
<h1 id="cnn---bilstm-model">CNN - BILSTM Model</h1>
</div>
<div id="36de70b1" class="cell code" data-execution_count="60">
<div class="sourceCode" id="cb83"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Input, Embedding, Conv1D, concatenate, Bidirectional, LSTM, Dense</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> models, optimizers</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> CNN_BiLSTM_model(sequence_length, vocabulary_size, embedding_dim, embedding_matrix, num_filters, kernel_size, lstm_units, units, learning_rate):</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Claim Channel</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    input_layer2 <span class="op">=</span> Input(shape<span class="op">=</span>(sequence_length,), dtype<span class="op">=</span><span class="st">&#39;int32&#39;</span>)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    embedding_layer2 <span class="op">=</span> Embedding(input_dim<span class="op">=</span>vocabulary_size, output_dim<span class="op">=</span>embedding_dim, input_length<span class="op">=</span>sequence_length,</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>                                weights<span class="op">=</span>[embedding_matrix], trainable<span class="op">=</span><span class="va">False</span>)(input_layer2)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    conv_layer2 <span class="op">=</span> Conv1D(num_filters, kernel_size<span class="op">=</span>kernel_size, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>)(embedding_layer2)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    dropout_layer2 <span class="op">=</span> Dropout(<span class="fl">0.5</span>)(conv_layer2)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Desc Channel</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    input_layer4 <span class="op">=</span> Input(shape<span class="op">=</span>(sequence_length,), dtype<span class="op">=</span><span class="st">&#39;int32&#39;</span>)</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    embedding_layer4 <span class="op">=</span> Embedding(input_dim<span class="op">=</span>vocabulary_size, output_dim<span class="op">=</span>embedding_dim, input_length<span class="op">=</span>sequence_length,</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>                                weights<span class="op">=</span>[embedding_matrix], trainable<span class="op">=</span><span class="va">False</span>)(input_layer4)</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>    conv_layer4 <span class="op">=</span> Conv1D(num_filters, kernel_size<span class="op">=</span>kernel_size, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>)(embedding_layer4)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>    dropout_layer4 <span class="op">=</span> Dropout(<span class="fl">0.5</span>)(conv_layer4)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenate or Merge</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>    merged_concat <span class="op">=</span> concatenate([dropout_layer2, dropout_layer4], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bi-LSTM layer</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>    bilstm_layer <span class="op">=</span> Bidirectional(LSTM(lstm_units, return_sequences<span class="op">=</span><span class="va">True</span>))(merged_concat)</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Global Max Pooling</span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>    pool_layer <span class="op">=</span> GlobalMaxPool1D()(bilstm_layer)</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Output layer</span></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>    output_layer <span class="op">=</span> Dense(units<span class="op">=</span>units, activation<span class="op">=</span><span class="st">&quot;sigmoid&quot;</span>)(pool_layer)</span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model compilation with optimizer and learning rate</span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optimizers.Adam(learning_rate<span class="op">=</span>learning_rate)  <span class="co"># Create optimizer instance with specified LR</span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> models.Model(inputs<span class="op">=</span>[input_layer2, input_layer4], outputs<span class="op">=</span>output_layer)</span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(optimizer<span class="op">=</span>optimizer,</span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>                  loss<span class="op">=</span><span class="st">&#39;binary_crossentropy&#39;</span>,</span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>                  metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>])</span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div id="e8ffc984" class="cell code" data-execution_count="61"
data-scrolled="true">
<div class="sourceCode" id="cb84"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> CNN_BiLSTM_model(sequence_length, vocabulary_size, embedding_dim, embedding_matrix, num_filters, kernel_size, lstm_units, units, learning_rate) </span></code></pre></div>
</div>
<div id="be6c9cd4" class="cell code" data-execution_count="62">
<div class="sourceCode" id="cb85"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Training CNN-BiLSTM with our own embeddings </span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit([X_train_claim_seq,X_train_desc_seq], Y_train,  <span class="co"># class_weight=class_weight_dict,</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>                   batch_size<span class="op">=</span>batch_size,</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>                   epochs<span class="op">=</span>epochs,</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>                   verbose<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>                   validation_split<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">1</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 109s 1s/step - accuracy: 0.3324 - loss: 0.3782 - val_accuracy: 0.5600 - val_loss: 0.2791
Epoch 2/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 85s 1s/step - accuracy: 0.5420 - loss: 0.2799 - val_accuracy: 0.5800 - val_loss: 0.2579
Epoch 3/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 75s 1s/step - accuracy: 0.6062 - loss: 0.2514 - val_accuracy: 0.6662 - val_loss: 0.2440
Epoch 4/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 76s 1s/step - accuracy: 0.6317 - loss: 0.2378 - val_accuracy: 0.6450 - val_loss: 0.2292
Epoch 5/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 75s 1s/step - accuracy: 0.6511 - loss: 0.2263 - val_accuracy: 0.6938 - val_loss: 0.2209
Epoch 6/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 76s 1s/step - accuracy: 0.6668 - loss: 0.2122 - val_accuracy: 0.6787 - val_loss: 0.2174
Epoch 7/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 85s 1s/step - accuracy: 0.6698 - loss: 0.2063 - val_accuracy: 0.6862 - val_loss: 0.2205
Epoch 8/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 79s 1s/step - accuracy: 0.6787 - loss: 0.2041 - val_accuracy: 0.6988 - val_loss: 0.2091
Epoch 9/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 75s 1s/step - accuracy: 0.6893 - loss: 0.1927 - val_accuracy: 0.6900 - val_loss: 0.2082
Epoch 10/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 75s 1s/step - accuracy: 0.6998 - loss: 0.1876 - val_accuracy: 0.6787 - val_loss: 0.2072
Epoch 11/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 76s 1s/step - accuracy: 0.7063 - loss: 0.1830 - val_accuracy: 0.6687 - val_loss: 0.2080
Epoch 12/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 75s 1s/step - accuracy: 0.7158 - loss: 0.1795 - val_accuracy: 0.6938 - val_loss: 0.2067
Epoch 13/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 79s 1s/step - accuracy: 0.7154 - loss: 0.1799 - val_accuracy: 0.6875 - val_loss: 0.2116
Epoch 14/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 76s 1s/step - accuracy: 0.7236 - loss: 0.1726 - val_accuracy: 0.6888 - val_loss: 0.2117
Epoch 15/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 87s 1s/step - accuracy: 0.7247 - loss: 0.1684 - val_accuracy: 0.7038 - val_loss: 0.2086
Epoch 16/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 80s 1s/step - accuracy: 0.7279 - loss: 0.1647 - val_accuracy: 0.6825 - val_loss: 0.2093
Epoch 17/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 76s 1s/step - accuracy: 0.7377 - loss: 0.1598 - val_accuracy: 0.6988 - val_loss: 0.2079
Epoch 18/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 78s 1s/step - accuracy: 0.7474 - loss: 0.1607 - val_accuracy: 0.6850 - val_loss: 0.2104
Epoch 19/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 77s 1s/step - accuracy: 0.7443 - loss: 0.1522 - val_accuracy: 0.6800 - val_loss: 0.2040
Epoch 20/20
72/72 ━━━━━━━━━━━━━━━━━━━━ 83s 1s/step - accuracy: 0.7501 - loss: 0.1522 - val_accuracy: 0.6762 - val_loss: 0.2100
CPU times: user 1h 30min 28s, sys: 49min 7s, total: 2h 19min 35s
Wall time: 26min 38s
</code></pre>
</div>
</div>
<div id="6fea5be2" class="cell markdown">
<h1 id="evaluation">Evaluation</h1>
</div>
<div id="9c1fc8dc" class="cell code" data-execution_count="63">
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_predict(model,X_test):</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    pred_proba <span class="op">=</span> model.predict(X_test)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (pred_proba)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pred_classes(pred_proba, number_of_cpc<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    pred_proba <span class="op">=</span> np.array(pred_proba)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> np.zeros_like(pred_proba)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    pred_prob_cpc <span class="op">=</span> []</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(pred_proba.shape[<span class="dv">0</span>]):</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>        idxs <span class="op">=</span> np.argsort(pred_proba[i])[::<span class="op">-</span><span class="dv">1</span>][:number_of_cpc]</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>        pred_prob_cpc.append(pred_proba[i, idxs])</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>        preds[i, idxs] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    pred_prob_cpc <span class="op">=</span> np.array(pred_prob_cpc)</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pred_prob_cpc, preds</span></code></pre></div>
</div>
<div id="ff1ccc28" class="cell code" data-execution_count="64">
<div class="sourceCode" id="cb88"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>pred_proba <span class="op">=</span> model_predict(model,[X_test_claim_seq,X_test_desc_seq])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>63/63 ━━━━━━━━━━━━━━━━━━━━ 9s 140ms/step
</code></pre>
</div>
</div>
<div id="5ef9d86c" class="cell code" data-execution_count="65">
<div class="sourceCode" id="cb90"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>pred_prob_cpc,pred_classes <span class="op">=</span> get_pred_classes(pred_proba, number_of_cpc <span class="op">=</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="336be861" class="cell markdown">
<h1
id="cnnbilstm-model-results-with-our-trained-word2vec-embeddings">CNN+BiLSTM
Model Results with our trained word2vec embeddings</h1>
</div>
<div id="73173c5b" class="cell markdown">
<p><strong>Precision</strong>: Measures the proportion of correctly
predicted positive cases out of all predicted positives. It answers: How
many of the predicted positives are actually correct?</p>
<p><strong>Recall</strong>: Measures the proportion of correctly
predicted positive cases out of all actual positives. It answers: How
many of the actual positives did we correctly identify?</p>
<p><strong>F1-Score</strong>: The harmonic mean of precision and recall,
providing a balanced measure when both are important.</p>
</div>
<div id="a63e0d5b" class="cell markdown">
<h2 id="top-2-labels-prediction">Top 2 labels prediction</h2>
</div>
<div id="67998de3" class="cell code" data-execution_count="66"
data-scrolled="true">
<div class="sourceCode" id="cb91"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the dimensions of the data</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Shape of Y_test: </span><span class="sc">{</span>Y_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Shape of pred_classes: </span><span class="sc">{</span>pred_classes<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> Y_test.shape <span class="op">==</span> pred_classes.shape:</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Precision:&quot;</span>, metrics.precision_score(Y_test, pred_classes, average<span class="op">=</span><span class="st">&#39;samples&#39;</span>))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Recall:&quot;</span>, metrics.recall_score(Y_test, pred_classes, average<span class="op">=</span><span class="st">&#39;samples&#39;</span>))</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;F1 Score:&quot;</span>, metrics.f1_score(Y_test, pred_classes, average<span class="op">=</span><span class="st">&#39;samples&#39;</span>))</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;The dimensions of Y_test and pred_classes do not match.&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Shape of Y_test: (2000, 9)
Shape of pred_classes: (2000, 9)
Precision: 0.58425
Recall: 0.8440416666666667
F1 Score: 0.6647666666666665
</code></pre>
</div>
</div>
<div id="666f4d82" class="cell code" data-execution_count="67">
<div class="sourceCode" id="cb93"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ploting the loss </span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> epochs</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">0</span>, N), history.history[<span class="st">&quot;loss&quot;</span>], label<span class="op">=</span><span class="st">&quot;train_loss&quot;</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">0</span>, N), history.history[<span class="st">&quot;val_loss&quot;</span>], label<span class="op">=</span><span class="st">&quot;val_loss&quot;</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Training Loss&quot;</span>)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Cross-Entropy Loss&quot;</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&quot;upper right&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="67">
<pre><code>&lt;matplotlib.legend.Legend at 0x212b90980&gt;</code></pre>
</div>
</div>
<div id="e540aab4" class="cell markdown">
<h1 id="error-analysis">Error Analysis</h1>
</div>
<div id="aacb3538" class="cell code" data-execution_count="68">
<div class="sourceCode" id="cb95"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_df_with_results(pred_proba, cpc<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    all_cpc <span class="op">=</span> mlb.classes_</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    pred_prob_cpc, pred_classes <span class="op">=</span> get_pred_classes(pred_proba, number_of_cpc<span class="op">=</span>cpc)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Getting the predicted and actual labels in each patent in the test set</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    predicted_cpc <span class="op">=</span> [all_cpc[np.argsort(pred_proba[i])[::<span class="op">-</span><span class="dv">1</span>][:cpc]] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(pred_proba.shape[<span class="dv">0</span>])]</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    actual_cpc <span class="op">=</span> [<span class="bu">list</span>(mlb.inverse_transform(Y_test)[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(pred_proba.shape[<span class="dv">0</span>])]</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Getting the individual precisions and recalls</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    precisions <span class="op">=</span> [metrics.precision_score(Y_test[i], pred_classes[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(pred_proba.shape[<span class="dv">0</span>])]</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    recalls <span class="op">=</span> [metrics.recall_score(Y_test[i], pred_classes[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(pred_proba.shape[<span class="dv">0</span>])]</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating a dataframe with all the results</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>    df_with_results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;predicted_cpcs&#39;</span>: predicted_cpc,</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;pred_probability&#39;</span>: [<span class="bu">list</span>(pred_prob_cpc[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pred_prob_cpc))],</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;actual_cpcs&#39;</span>: actual_cpc,</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;precision&#39;</span>: precisions,</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;recall&#39;</span>: recalls</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_with_results</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_total_scores(df_with_results):</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>    total_prec <span class="op">=</span> <span class="bu">round</span>(df_with_results.precision.mean(), <span class="dv">3</span>)</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>    total_recall <span class="op">=</span> <span class="bu">round</span>(df_with_results.recall.mean(), <span class="dv">3</span>)</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>    total_f1 <span class="op">=</span> <span class="bu">round</span>(<span class="dv">2</span> <span class="op">*</span> (total_prec <span class="op">*</span> total_recall) <span class="op">/</span> (total_prec <span class="op">+</span> total_recall), <span class="dv">3</span>)</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">print</span>(<span class="st">&quot;Precision: </span><span class="sc">{}</span><span class="st">, Recall: </span><span class="sc">{}</span><span class="st">, F1-score: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(total_prec, total_recall, total_f1))</span></code></pre></div>
</div>
<div id="21b7e6b0" class="cell markdown">
<h2 id="cnn--bilstm">CNN + BiLSTM</h2>
</div>
<div id="f44ba48d" class="cell markdown">
<h2 id="top-2-label---precision-recall-and-f1-score">Top 2 Label -
Precision, Recall and F1-score</h2>
</div>
<div id="fda25593" class="cell code" data-execution_count="69">
<div class="sourceCode" id="cb96"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.datetime.now())</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>df_with_results <span class="op">=</span> get_df_with_results(pred_proba,cpc<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>calculate_total_scores(df_with_results)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.datetime.now())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>2024-11-18 19:56:03.321511
Precision: 0.826, Recall: 0.645, F1-score: 0.724
2024-11-18 19:56:27.185580
</code></pre>
</div>
</div>
<div id="026d0d6d" class="cell code" data-execution_count="70">
<div class="sourceCode" id="cb98"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>df_with_results_2 <span class="op">=</span> get_df_with_results(pred_proba,cpc<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>calculate_total_scores(df_with_results)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Precision: 0.826, Recall: 0.645, F1-score: 0.724
</code></pre>
</div>
</div>
<div id="ebfbf262" class="cell code" data-execution_count="71">
<div class="sourceCode" id="cb100"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df_with_results_2.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="71">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>predicted_cpcs</th>
      <th>pred_probability</th>
      <th>actual_cpcs</th>
      <th>precision</th>
      <th>recall</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[c, b]</td>
      <td>[0.9930345, 0.27455673]</td>
      <td>[c]</td>
      <td>0.5</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[h, y]</td>
      <td>[0.9659968, 0.96256787]</td>
      <td>[h, y]</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[h, y]</td>
      <td>[0.99846655, 0.0586969]</td>
      <td>[h]</td>
      <td>0.5</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[a, c]</td>
      <td>[0.9554879, 0.8941402]</td>
      <td>[a]</td>
      <td>0.5</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[b, y]</td>
      <td>[0.98430425, 0.44510323]</td>
      <td>[b]</td>
      <td>0.5</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="a13f91c8" class="cell code" data-execution_count="72">
<div class="sourceCode" id="cb101"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the list of CPCs that were misclassified for each document</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>delta <span class="op">=</span> []</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(df_with_results.shape[<span class="dv">0</span>]):</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    delta.append(<span class="bu">list</span>(<span class="bu">set</span>(df_with_results.iloc[i].actual_cpcs).difference(<span class="bu">set</span>(df_with_results.iloc[i].predicted_cpcs))))</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>erroneous_cpcs <span class="op">=</span> Counter()</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> delta:</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        erroneous_cpcs.update(i)</span></code></pre></div>
</div>
<div id="bfec9668" class="cell code" data-execution_count="73">
<div class="sourceCode" id="cb102"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the list of CPCs that were classified correctly for each document</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>delta_correct <span class="op">=</span> []</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(df_with_results.shape[<span class="dv">0</span>]):</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    delta_correct.append(<span class="bu">list</span>(<span class="bu">set</span>(df_with_results.iloc[i].predicted_cpcs).intersection(<span class="bu">set</span>(df_with_results.iloc[i].actual_cpcs))))</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>correct_cpcs <span class="op">=</span> Counter()</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> delta_correct:</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>        correct_cpcs.update(i)</span></code></pre></div>
</div>
<div id="c440adc2" class="cell code" data-execution_count="74">
<div class="sourceCode" id="cb103"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>Result_analysis <span class="op">=</span> pd.DataFrame([</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    [k, correct_cpcs[k], erroneous_cpcs[k], </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>     erroneous_cpcs[k] <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> (erroneous_cpcs[k] <span class="op">+</span> correct_cpcs[k]), </span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>     correct_cpcs[k] <span class="op">+</span> erroneous_cpcs[k], </span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>     pl[k] <span class="op">-</span> (correct_cpcs[k] <span class="op">+</span> erroneous_cpcs[k])]</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> erroneous_cpcs</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>], columns<span class="op">=</span>[<span class="st">&#39;Sub_Class&#39;</span>, <span class="st">&#39;Correct_predictions&#39;</span>, <span class="st">&#39;Erroneous_Predictions&#39;</span>, </span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;Error_percentage&#39;</span>, <span class="st">&#39;no_of_test_documents&#39;</span>, <span class="st">&#39;no_of_training_documents&#39;</span>]) <span class="op">\</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    .sort_values(by<span class="op">=</span><span class="st">&#39;Error_percentage&#39;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying the dataframe</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Result_analysis)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>python(22809) MallocStackLogging: can&#39;t turn off malloc stack logging because it was not enabled.
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>  Sub_Class  Correct_predictions  Erroneous_Predictions  Error_percentage  \
0         y                   20                    247         92.509363   
7         d                    6                     19         76.000000   
4         b                  256                    240         48.387097   
8         e                   29                     27         48.214286   
6         a                  182                    142         43.827160   
2         h                  402                    240         37.383178   
3         f                  172                     87         33.590734   
1         g                  408                    190         31.772575   
5         c                  177                     76         30.039526   

   no_of_test_documents  no_of_training_documents  
0                   267                      1107  
7                    25                       135  
4                   496                      1956  
8                    56                       227  
6                   324                      1258  
2                   642                      2572  
3                   259                      1052  
1                   598                      2423  
5                   253                      1031  
</code></pre>
</div>
</div>
<div id="4a9fbbdb" class="cell code" data-execution_count="75">
<div class="sourceCode" id="cb106"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sorting by Error_percentage in descending order</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>Result_analysis <span class="op">=</span> Result_analysis.sort_values(by<span class="op">=</span><span class="st">&#39;Error_percentage&#39;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar plot</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting all 9 CPCs</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.barplot(y<span class="op">=</span><span class="st">&quot;no_of_training_documents&quot;</span>, x<span class="op">=</span><span class="st">&quot;Sub_Class&quot;</span>, edgecolor<span class="op">=</span><span class="st">&quot;.6&quot;</span>,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>                data<span class="op">=</span>Result_analysis, ax<span class="op">=</span>ax)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate x-axis labels for better visibility</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>g.set_xticklabels(g.get_xticklabels(), rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Set plot title</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>g.set_title(<span class="st">&#39;Number of Training Documents by CPC&#39;</span>)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_15d2a14ad9ef47139faaa2cb2395fc44/f700fdebf401c4674d545ef7fff418874125d632.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_15d2a14ad9ef47139faaa2cb2395fc44/4c2ddada6d5076143624e507ed1d559c37b4f0e6.png" /></p>
</div>
</div>
<div id="feb1ad5b" class="cell code" data-execution_count="76">
<div class="sourceCode" id="cb107"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting some examples on the classfication for the class &#39;d&#39;</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>delta_incorrect_d<span class="op">=</span>[]</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,d <span class="kw">in</span> <span class="bu">enumerate</span>(delta):</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;d&#39;</span> <span class="kw">in</span> d:</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>        delta_incorrect_d.append(i)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>df_with_results.iloc[delta_incorrect_d].head(<span class="dv">10</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="76">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>predicted_cpcs</th>
      <th>pred_probability</th>
      <th>actual_cpcs</th>
      <th>precision</th>
      <th>recall</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15</th>
      <td>[a]</td>
      <td>[0.94750863]</td>
      <td>[d]</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>44</th>
      <td>[b]</td>
      <td>[0.7639755]</td>
      <td>[a, d, g]</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>288</th>
      <td>[b]</td>
      <td>[0.9498903]</td>
      <td>[b, d]</td>
      <td>1.0</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>692</th>
      <td>[f]</td>
      <td>[0.50556463]</td>
      <td>[d, y]</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>806</th>
      <td>[a]</td>
      <td>[0.83284837]</td>
      <td>[d]</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>935</th>
      <td>[e]</td>
      <td>[0.59024686]</td>
      <td>[d]</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1035</th>
      <td>[b]</td>
      <td>[0.8779241]</td>
      <td>[b, d, e]</td>
      <td>1.0</td>
      <td>0.333333</td>
    </tr>
    <tr>
      <th>1099</th>
      <td>[f]</td>
      <td>[0.71407366]</td>
      <td>[d]</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1148</th>
      <td>[c]</td>
      <td>[0.9816444]</td>
      <td>[c, d]</td>
      <td>1.0</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>1307</th>
      <td>[f]</td>
      <td>[0.8195114]</td>
      <td>[d]</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</body>
</html>
